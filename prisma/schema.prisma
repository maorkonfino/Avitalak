// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  phone         String?
  password      String
  role          UserRole  @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  appointments  Appointment[]
  waitlist      Waitlist[]
}

model Service {
  id          String    @id @default(cuid())
  name        String    @unique
  nameEn      String?
  description String?
  duration    Int       // in minutes
  price       Float
  category    String    // 转, 专住, 爪驻专, 转, 
  icon        String?   // lucide icon name
  active      Boolean   @default(true)
  // Available days: 0=Sunday, 1=Monday, ... 6=Saturday
  availableDays String  @default("0,1,2,3,4")  // JSON array as string: "0,1,2,3,4,5"
  // Available hours: "09:00-18:00"
  startTime   String    @default("09:00")
  endTime     String    @default("18:00")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  appointments Appointment[]
  waitlist    Waitlist[]
}

model Appointment {
  id          String            @id @default(cuid())
  userId      String
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  serviceId   String
  service     Service           @relation(fields: [serviceId], references: [id])
  date        DateTime
  endDate     DateTime
  status      AppointmentStatus @default(PENDING)
  notes       String?
  reminderSent Boolean          @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([date])
  @@index([userId])
  @@index([status])
}

model Waitlist {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id])
  date        DateTime
  timeSlot    String   // "09:00", "09:30", etc.
  notified    Boolean  @default(false)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date])
  @@index([serviceId])
  @@index([active])
}

model Settings {
  id                          String   @id @default(cuid())
  // Email notification templates
  newAppointmentEmailSubject  String   @default("砖专 拽注转 转专 - Avital Ak")
  newAppointmentEmailBody     String   @default("砖 {{customerName}},\n\n转专 砖 拽注 爪!\n\n驻专 转专:\n 转专: {{date}}\n 砖注: {{time}}\n 砖专转: {{serviceName}}\n憋 砖: {{duration}} 拽转\n 专: {{price}}\n\n转专 拽专!\n")
  
  updatedAppointmentEmailSubject String @default("注 转专 - Avital Ak")
  updatedAppointmentEmailBody    String @default("砖 {{customerName}},\n\n转专 砖 注!\n\n驻专 转专 砖:\n 转专: {{date}}\n 砖注: {{time}}\n 砖专转: {{serviceName}}\n憋 砖: {{duration}} 拽转\n\n转专 拽专!\n")
  
  cancelledAppointmentEmailSubject String @default(" 转专 - Avital Ak")
  cancelledAppointmentEmailBody    String @default("砖 {{customerName}},\n\n转专 砖 .\n\n驻专 转专:\n 转专: {{date}}\n 砖注: {{time}}\n 砖专转: {{serviceName}}\n\n转 拽注 转专 砖 专 转专.\n\n")
  
  reminderEmailSubject        String   @default("转专转 转专 专 - Avital Ak")
  reminderEmailBody           String   @default("砖 {{customerName}},\n\n专爪 专  砖砖  转专 专!\n\n 转专: {{date}}\n 砖注: {{time}}\n 砖专转: {{serviceName}}\n憋 砖: {{duration}} 拽转\n\n 专转 转!\n")
  
  waitlistNotificationSubject String   @default("转专 转驻! - Avital Ak")
  waitlistNotificationBody    String   @default("砖 {{customerName}},\n\n 砖 砖转 转! 转专 转驻!\n\n 转专: {{date}}\n 砖专转: {{serviceName}}\n\n专 住 转专 拽注 转 转专 驻 砖 拽.\n\n")
  
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
}
